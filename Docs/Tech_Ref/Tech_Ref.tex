\documentclass[12pt,twoside]{book}

\input{../Bibliography/commoncommands}

\begin{document}

\bibliographystyle{unsrt}

\frontmatter

\pagestyle{empty}


\begin{minipage}[t][9in][s]{6.5in}

\headerA{1889v1\\}

\headerB{
CFAST -- Consolidated Fire \\
 and Smoke Transport \\
 (Version 7) \\
 Volume 1: Technical Reference Guide \\
}

\headerC{
   Richard D. Peacock \\
   Kevin B. McGrattan \\
   Glenn P. Forney \\
   Paul A. Reneke \\
}

\vfill

\headerD{1889v1}

\vfill

\logosigs

\end{minipage}

\newpage

\hspace{5in}

\newpage

\begin{minipage}[t][9in][s]{6.5in}

\headerA{1889v1\\}

\headerB{
CFAST -- Consolidated Fire \\
 And Smoke Transport \\
 (Version 7) \\
 Volume 1: Technical Reference Guide \\
}

\headerC{
   Richard D. Peacock \\
   Kevin B. McGrattan \\
   Glenn P. Forney \\
   Paul A. Reneke \\
}

\headerD{1889v1}

\headerC{
\flushright{\mydate\today\\
CFAST Version \cfastversion \\
\emph{GIT Revision:}~\gitrevision}}

\vfill

\flushright{\includegraphics[width=1.2in]{FIGURES/doc} }

\titlesigs

\end{minipage}


\newpage

\frontmatter

\pagestyle{plain}
\setcounter{page}{3}

%
% -------------------  Preface ------------------------
%

\chapter{Preface}

This document provides the theoretical basis for the Consolidated Fire And Smoke Transport (CFAST) model, following the general framework set forth in the ``Standard Guide for Evaluating the Predictive Capability of Deterministic Fire Models,'' ASTM~E~1355~\cite{ASTM:E1355}. Instructions for using CFAST are contained in a separate user's guide, and model assessment information is contained in a separate verification and validation guide.

%
% -------------------  Disclaimer ------------------------
%

\chapter{Disclaimer}

The US Department of Commerce makes no warranty, expressed or implied, to users of CFAST, and accepts no responsibility for its use. Users of CFAST assume sole responsibility under Federal law for determining the appropriateness of its use in any particular application; for any conclusions drawn from the results of its use; and for any actions taken or not taken as a result of analysis performed using these tools.

Users are warned that CFAST is intended for use only by those competent in the fields of fluid dynamics, thermodynamics, heat transfer, combustion, and fire science, and is intended only to supplement the informed judgment of the qualified user. The software package is a computer model that may or may not have predictive capability when applied to a specific set of factual circumstances. Lack of accurate predictions by the model could lead to erroneous conclusions with regard to fire safety. All results should be evaluated by an informed user.

Throughout this document, the mention of computer hardware or commercial software does not constitute endorsement by the National Institute of Standards and Technology, nor does it indicate that the products are necessarily those best suited for the intended purpose.

\coden{1889v1}

%
% -------------------  Acknowledgments ------------------------
%

\chapter{Acknowledgments}

\label{acksection}

CFAST was originally developed by Walter Jones, formerly of NIST.

Continuing support for CFAST is via internal funding at NIST. In addition, support is provided by other agencies of the U.S. Federal Government, most notably the Nuclear Regulatory Commission (NRC) and the Department of Energy (DOE). The NRC Office of Research has funded key validation experiments, the preparation of the CFAST manuals, and the continuing development of sub-models that are of importance in the area of nuclear power plant safety. Special thanks to Mark Salley and David Stroup for their support. Support to refine the software development and quality assurance process for CFAST has been provided by the DOE. The assistance of Subir Sen and Debra Sparkman is gratefully acknowledged.

Doug Carpenter, Combustion Sciences and Engineering, has contributed numerous corrections, clarifications, and updates to the guides and the model through his detailed review of the model and documentation. Allan Coutts, Washington Safety Management Solutions, provided insight into the application of fire models to nuclear safety applications and detailed review of the CFAST document updates for DOE.

Colleen Wade of the Building Research Association of New Zealand (BRANZ), Fred Mowrer of the California Polytechnic State University, and David Sheppard of the U.S. Bureau of Alcohol, Tobacco and Firearms (ATF) provided useful comments on the development of CFAST version 7.


\tableofcontents

\listoffigures


\mainmatter

%
% -------------------  Overview ------------------------
%

\chapter{Overview}

This chapter provides a general description of the Consolidated Fire And Smoke Transport (CFAST) model following the general guidance put forth in ASTM E1355~\cite{ASTM:E1355}.

\section{Model Type}

CFAST is a two-zone fire model that predicts the thermal environment caused by a fire within a compartmented structure. Each compartment is divided into an upper and lower gas layer (zone in the term zone fire model refers to the layers being modeled). The fire drives combustion products from the lower to the upper layer via the plume. The temperature within each layer is uniform, and its evolution in time is described by a set of ordinary differential equations derived from the fundamental laws of mass and energy conservation. The transport of smoke and heat from zone to zone is dictated by empirical correlations. Because the governing equations are relatively simple, CFAST simulations typically require a few tens of seconds of CPU time on typical personal computers.


\section{Model Version}

The first public release of CFAST was version 1.0 in June, 1990. This version was restructured from FAST~\cite{Models:FAST} to incorporate the ``lessons learned'' from the zone model CCFM developed by Cooper and Forney~\cite{Models:CCFM}. Version~2 was released as a component of Hazard~1.2 in 1994~\cite{Models:HAZARDI, Models:HAZARDI_12}. The first of the 3.x series was released in 1995 and included a vertical flame spread algorithm, ceiling jets and non-uniform heat loss to the ceiling, spot targets, and heating and burning of multiple objects (ignition by heat flux, temperature or time) in addition to multiple prescribed fires. As it evolved over the next five years, version~3 included smoke and heat detectors, suppression through heat release reduction, better characterization of flow through doors and windows, vertical heat conduction through ceiling/floor boundaries, and non-rectangular compartments. In 2000, version~4 was released and included horizontal heat conduction through walls, and horizontal smoke flow in corridors. Version~5 improved the combustion chemistry. Version 6, released in July, 2005, incorporates a more consistent implementation of vents, fire objects, and event processing and includes a graphical user interface which substantially improves its usability.

The current version of CFAST, version 7, was released in 2015.


\section{Model Developers}

CFAST was developed and is maintained by the Fire Research Division of the National Institute of Standards and Technology. The developers are Richard Peacock, Glenn Forney, and Paul Reneke. Kevin McGrattan has participated in the changes leading to CFAST, version 7.

\section{Relevant Publications}

The manuals for CFAST consist of this Technical Reference Guide, a User's Guide~\cite{CFAST_Users_Guide_7}, a Verification and Validation Guide~\cite{CFAST_Valid_Guide_7}, and a Configuration Management Guide~\cite{CFAST_Config_Guide_7}.  The Technical Reference Guide describes the underlying physical principles. The User's Guide describes how to use the model. The Verification and Validation Guide documents sensitivity analyses, model verification, model validation, and model limitations consistent with ASTM~E1355~\cite{ASTM:E1355}. The Configuration Management Guide documents the processes used during the development and validation of the model.

The U.S. Nuclear Regulatory Commission has published a verification and validation study of five selected fire models commonly used in support of risk-informed and performance-based fire protection at nuclear power plants~\cite{NRCNUREG1824}. In addition to an extensive study of the CFAST model, the report compares the output of several other models ranging from simple hand calculations to more complex computational fluid dynamics codes such as the Fire Dynamics Simulator (FDS) developed by the National Institute of Standards and Technology (NIST) \cite{FDS_Tech_Guide_6}.


\section{Governing Equations and Assumptions}

The governing equations of CFAST are for conservation of mass and energy within the lower and upper layers of connected compartments within a building. The momentum within any one zone is assumed to be zero.  Momentum between zones in adjacent compartments is accounted for in terms of horizontal or vent flow equations (Bernoulli's law). Other features of CFAST include:
\begin{itemize}
\item Compartment geometry: CFAST is generally limited to fire scenarios where the compartment volumes are strongly stratified. The empirical correlations contained in CFAST were developed for relatively uncluttered, flat ceilings in compartments that can be characterized as ``rooms'' as opposed to corridors or vertical shafts. There are no hard limits on what kind of compartment can or cannot be modeled in CFAST. The CFAST Validation Guide indicates the accuracy of its predictions for compartments of various aspect ratios.
\item Heat Release Rate: CFAST does not predict fire growth on burning objects. The heat release rate is specified by the user for one or more fires. There is a simple sub-model to limit the heat release based on available oxygen.
\item Radiation from fires is modeled with a simple point source approximation.  This limits the accuracy of the model within a few diameters of the fire. Calculation of radiative exchange between compartments is not modeled.
\item Mechanical ventilation is modeled by specifying volumetric flow rates into or out of compartments. The overall HVAC (heating, ventilation, air conditioning) system is not modeled.
\item Natural Ventilation and Leakage: The flow through vertical openings, like doors and windows, is modeled using the Bernoulli equation for the pressure difference between two compartments. Horizontal openings, like hatches, are treated with a single empirical correlation based on pressure and density differences between upper and lower compartments. Leakage is modeled by explicitly creating a small vertical or horizontal opening.
\item Suppression: CFAST predicts sprinkler activation based on an empirical ceiling jet correlation and activation model. A simple suppression model decreases the specified heat release rate.
\end{itemize}
The technical approach and assumptions of the model have been presented in the peer-reviewed scientific literature~\cite{Jones:1993a, Jones:1985, Jones:1984} and conference proceedings~\cite{Jones:1991}. CFAST has been reviewed and included in industry-standard handbooks such as the SFPE Handbook~\cite{Walton:2003} and referenced in specific standards, including NFPA~805~\cite{NFPA805:2004} and NFPA~551~\cite{NFPA551:2004}.

Also, all documents released by NIST are required to go through an internal editorial review and approval process. This process is designed to ensure compliance with the technical requirements, policy, and editorial quality required by NIST. The technical review includes a critical evaluation of the technical content and methodology, statistical treatment of data, uncertainty analysis, use of appropriate reference data and units, and bibliographic references. CFAST manuals are always first reviewed by a member of the Fire Research Division, then by the immediate supervisor of the author of the document, then by the chief of the Fire Research Division, and finally by a reader from outside the division. These reviewers are technical experts in the field. Once the document has been reviewed, it is then brought before the Editorial Review Board (ERB), a body of representatives from all the NIST laboratories. At least one reader is designated by the Board for each document that it accepts for review. This last reader is selected based on technical competence and impartiality. The reader is usually from outside the division producing the document and is responsible for checking that the document conforms with NIST policy on units, uncertainty and scope. This reader does not need to be a technical expert in fire or combustion.

Besides formal internal and peer review, CFAST is subjected to continuous scrutiny because it is available to the general public and is used internationally by those involved in fire safety design and postfire reconstruction. The source code for CFAST is also released publicly, and has been used at various universities worldwide, both in the classroom as a teaching tool as well as for research. As a result, flaws in the theoretical development and the computer program itself have been identified and fixed. The user base continues to serve as a means to evaluate the model, which is as important to its development as the formal internal and external peer review processes.

For each major release of CFAST, NIST has maintained a history of the source code which goes back to March 1989.  While it is not practical to reconstruct the programs for each release for use with modern software tools and computer operating systems, the source code history allows the developers to examine what changes were made at each release point. This provides detailed documentation of the history of model development and is often useful to understand the impact of changes to sub-models as the model continues to evolve.




\section{Input Data Required to Run the Model}

All of the data required to run the CFAST model reside in a single input file that the user generates. The file consists of the following information:
\begin{itemize}
\item compartment dimensions (height, width, length)
\item lining materials of the floor, walls, and ceiling of each compartment, respectively
\item material properties (e.g., thermal conductivity, specific heat, density, thickness, heat of combustion)
\item dimensions and positions of horizontal and vertical flow openings such as doors, windows, and vents
\item mechanical ventilation specifications
\item fire properties (e.g., heat release rate, lower oxygen limit, and species production rates as a function of time)
\item sprinkler and detector specifications
\item positions, sizes, and characteristics of targets
\end{itemize}
The input files are provided for the validation exercises described in the Validation Guide~\cite{CFAST_Valid_Guide_7}. A complete description of the input parameters can be found in the CFAST User's Guide~\cite{CFAST_Users_Guide_7}.

A comprehensive assessment of the numerical parameters (such as default time step or solution convergence criteria) and physical parameters (such as empirical constants for convective heat transfer or plume entrainment) used in CFAST is not available in one document. Instead, specific parameters have been tested in various verification and validation studies performed at NIST and elsewhere. Numerical parameters are described in this Technical Reference Guide and are subject to the internal review process at NIST, but many physical parameters are extracted from the literature and do not undergo a formal review. The model user is expected to assess the appropriateness of default values provided by CFAST and make changes to the default values, if needed.



\section{Model Results}

The output of CFAST are the sensible variables that are needed for assessing the environment in a building subjected to a fire. Once the simulation is complete, CFAST produces an output file containing all of the solution variables.  Typical outputs include (but are not limited to) the following:
\begin{itemize}
\item environmental conditions in the room (such as hot gas layer temperature; plume centerline temperature; oxygen and smoke concentration; and ceiling, wall, and floor temperatures)
\item heat transfer-related outputs to walls and targets (such as incident convective, radiative, and total heat fluxes)
\item fire intensity and flame height
\item flow velocities through vents and openings
\item detector and sprinkler activation times
\end{itemize}


\section{Model Scenarios}

While the governing transport equations are based on the fundamental conservation laws of mass and energy, the fire-specific algorithms within CFAST are based on empirical correlations. These correlations include fire plume and ceiling jet temperatures and velocities, vent flow rates, sprinkler activation, and so on. These sub-models were developed independently of each other under ideal conditions. CFAST combines these sub-models in such a way that there are no hard limits on when a particular sub-model is appropriate or not. The decision as to whether CFAST is appropriate for a given fire scenario is based primarily on the hundreds of experiments and thousands of point-to-point comparisons between CFAST and measured quantities that are included in the CFAST Validation Guide~\cite{CFAST_Valid_Guide_7}. This document includes a list of the experiments and their important physical attributes such as the nature of the fire, the aspect ratio of the compartment, the ventilation rate, and the relative location of targets. For each quantity of interest, such as upper layer temperature or target heat flux, there is a calculated bias factor and standard deviation that indicates the accuracy of the model for the particular quantity of interest which is based on measurement uncertainty. Thus, the CFAST Validation Guide indicates what fire scenarios are appropriate for CFAST, and the degree of accuracy that can be expected for a particular type of prediction.

In addition to what is included in the CFAST Validation Guide, validation studies have been performed by NIST grantees, students at universities, and engineering firms using the model.  Because each organization has its  own reasons for  validating the model, the  referenced papers and reports do not follow any particular guidelines. Some of the works only provide  a qualitative assessment  of the model,  concluding that the  model  agreement with  a  particular  experiment  is ``good''  or ``reasonable.'' Sometimes, the conclusion is that the model works well in certain cases, not as well in others. These studies are included in the survey because the references  are useful to other model users who may have a similar application  and are interested in qualitative assessment. It is important to note  that some of the papers point out flaws in early releases of CFAST that have been corrected or improved in more recent  releases. Some of  the issues raised, however,  are still subjects of  active research. Continued updates for CFAST  are greatly influenced by the feedback provided by users, often through publication of validation efforts.

\section{Organization of this Document}

The rest of this document is broken into several chapters as follows:

\begin{description}
\item[Chapter 2] presents the basic transport equations used by CFAST derived from the conservation laws of mass and energy, along with the ideal gas law.
\item[Chapter 3] describes the algorithms and empirical correlations used to represent fires in the model, including combustion chemistry and heat release rate, plume entrainment, plume temperature, and plume velocity.
\item[Chapter 4] includes the empirical correlations used to estimate natural flow through doors and windows (vertically-oriented vents), floor and ceiling vents (horizontally-oriented vents), and mechanical ventilation systems.
\item[Chapter 5] documents the calculation of heat transfer including radiation exchange between fires, walls, gas layers, and objects within compartments, convection between gases and compartment bounding surfaces or objects within compartments, and conduction in compartment bounding surfaces and object within compartments.
\item[Chapter 6] details calculations for fire sprinkler and heat detector activation, smoke detection, fire suppression, and visibility through smoke.
\end{description}

%
% -------------------  The Basic Transport Equations ------------------------
%

\chapter{The Basic Transport Equations}
\label{sec:Theory_Chapter}

The equations used to model pressure, layer height and temperatures in CFAST take the form of an initial value problem for a system of ordinary differential equations. These equations are derived from the principles of conservation of mass and energy using the ideal gas law as an equation of state to relate temperature and density. These equations predict the evolution in time of the compartment pressure (at the floor), upper layer volume, and layer temperatures due to the net gain or loss of mass and energy in these layers. The primary assumption of a zone model is that properties such as temperature can be approximated throughout a control volume by a representative average value. Many formulations based upon these assumptions can be derived~\cite{Forney:1994}. Though equivalent mathematically, these formulations differ in their numerical solution.

The exchange of mass and energy or heat between zones is due to physical phenomena such as fire plumes, natural and forced ventilation, convective and radiative heat transfer, and so on. For example, a vent exchanges mass and heat between zones in connected rooms, a fire plume typically adds heat to the upper layer and transfers entrained mass and heat from the lower to the upper layer, and convection transfers heat from the gas layers to the surrounding walls.  The momentum within any one zone is assumed to be zero. Momentum exchange between zones in adjacent compartments is accounted for in terms of horizontal or vent flow equations (Bernoulli's law).

\newcommand{\qdot}{\dot{q}}
\section{Modeling Equations}
\label{sect:equations}

It is assumed that each compartment is divided into two control volumes or zones, a relatively hot upper layer and a relatively cool lower layer, as illustrated in Fig.~\ref{fig:Control_Volumes}. The gas temperature and density are assumed constant in each layer. The compartment as a whole is assumed to have a single value of pressure, $P$. It is also assumed that all thermodynamic parameters are constant. The specific heat at constant volume and at constant pressure, $c_v$ and $c_p$, the specific\footnote{The specific gas constant is the universal gas constant divided by the molar mass of the gas mixture. In CFAST, it is assumed that the molar mass of the mixture is that of air; thus, the specific gas constant is indeed constant.} gas constant, $R$, and the ratio of specific heats, $\gamma$, are related by $\gamma = c_p / c_v$ and $R = c_p- c_v$. Regardless of the composition of the gas mixture, $c_p = 1012$~J/(kg$\cdot$K) and $\gamma = 1.4$; thus,
\be
   R = \frac{\gamma-1}{\gamma} \, c_p \approx 289.14 \; \frac{{\rm J}}{{\rm kg} \cdot {\rm K}}
\ee
\begin{figure}[h]
\centering
\includegraphics[width=\textwidth]{FIGURES/Control_Volumes}
\caption{Schematic of control volumes in a two-layer zone model.}
 \label{fig:Control_Volumes}
\end{figure}

The set of governing equations start with the conservation of mass which may be expressed as the net rate of mass added to a control volume, $\dot m_i$, is equal to the rate at which mass accumulates in that control volume, $\dbydt{m_i}$ or equivalently
\be
   \dbydt{m_i} = \dot m_i  \label{mass_con}
\ee
where $\dm_i$ represents the sum of all mass flow terms, such as plume mass entrainment and ventilation, entering and leaving layer $i$. Similarly, the conservation of energy may be stated as the net rate that heat $\qdot_i$ is added to a control volume minus the work $P\dbydt{V_i}$ performed by the control volume (since the control volume may change size), is equal to the rate at which heat or internal energy $\ddt\left(c_v m_i T_i\right)$ accumulates within the control volume or equivalently
\be
   \ddt\left(c_v m_i T_i\right)   =  \qdot_i - P \dbydt{V_i}\label{eq:first_law}
\ee

Stated in this way, conservation of energy is the first law of thermodynamics.  The heat source term, $\qdot_i$, consists of the fire's heat release rate, convective losses to walls, and radiation exchange. The layer temperature and density are related to the compartment pressure via the ideal gas law:
\be
  P = R \, \rho_i \, T_i \label{EoS}
\ee

A system of ordinary differential equations for pressure, upper layer volume, upper and lower layer temperature are derived in Appendix \ref{chap:derivation}
 using the conservation of mass and energy and are given below:

\begin{eqnarray}
\dbydt{P} &=& \frac{{\gamma-1}}{{V}} \left( \qdot_l + \qdot_u \right)  \label{eq1} \\[.1in]
\dbydt{\Vu} &=& \frac{1}{P \gamma} \left( (\gamma-1) \, \qdot_u - \Vu \dbydt{P} \right) \label{eq2} \\[.1in]
\dbydt{\Tu} &=& \frac{1}{c_p \, m_{\rm u}} \left( \qdot_u - c_p \, \dmau \, \Tu + \Vu \dbydt{P} \right) \label{eq3} \\[.1in]
\dbydt{\Tl} &=& \frac{1}{c_p \, m_{\rm l}} \left( \qdot_l - c_p \, \dmal \, \Tl + \Vl \dbydt{P} \right) \label{eq4}
\end{eqnarray}

The mass flow, $\dmau$ and $\dmal$, and heat flow, $\qdot_u$ and $\qdot_l$, terms are simply the net sum of all mass and heat flowing into a layer (through vents, from fires, between layers via a plume, or by radiation and convection from compartment surfaces).

Algebraic equations for wall surface temperatures can be derived using Fourier's law
\be
   \dq'' = -k \, \frac{dT}{dx}  \label{eq:fourier}
\ee

\noindent so that the temperature gradient, $dT/dx$, at the wall surface is consistent with the heat flux, $\dq''$,
striking that surface.  CFAST then uses the differential~/~algebraic solver DASSL to solve Eqs. (\ref{eq1}) through (\ref{eq:fourier}).


\section{Solution of the Equations}

As discussed in Refs.~\cite{Forney:1994} and \cite{Rehm:1992}, Eqs.~(\ref{eq1}) through (\ref{eq:fourier}) are stiff since pressure reacts to changing conditions much more rapidly than other solution variables. Stiff problems require special solution techniques since solution methods such as Runge-Kutta or Adams-Bashforth require prohibitively small time steps in order to track the short time scale phenomena (pressure in our case) found in fire modeling scenarios. Methods that use the Jacobian on the other hand have a much larger stability region for stiff problems and are thus more successful at their solution (see, for example, \cite{Numerical_Recipes}).

Equations (\ref{eq1})~-~(\ref{eq:fourier}) are then solved as a set of simultaneous differential~/~algebraic equations of the form $F\brackets{t,\vec{y},\vec{y}'}=0$ using the stiff DAE (differential algebraic equation) solver, DASSL \cite{DASSL:1982,DASSL:1989}, where $F\brackets{t,\vec{y},\vec{y}'}$ is the functional relationship between $t$ (the current time in the simulation), $\vec{y}$ (the solution vector at time $t$), and $\vec{y}'$ (the solution vector derivative at time $t$). The solution vector, $\vec{y}$, solved by DASSL is

\begin{center}
\begin{tabular}{r l l}
$\boldsymbol{\vec{y}} =$& $(P_1, P_2, ..., P_{n-1}, P_n,$ & (pressures for each compartment)  \\
               &  $T_{U_1}, T_{U_2}, ..., T_{U_{n-1}}, T_{U_n}$ & (upper layer temperatures for each compartment)  \\
               &  $V_{U_1}, V_{U_2}, ..., V_{U_{n-1}}, V_{U_n}$ & (upper layer volumes for each compartment)  \\
               &  $T_{L_1}, T_{L_2}, ..., T_{L_{n-1}}, T_{L_n}$ & (lower layer temperatures for each compartment)  \\
               &  $T_{W_1}, T_{W_2}, ..., T_{W_{k-1}}, T_{W_k} )$ & (temperatures on each surface of each compartment) \\
\end{tabular}
\end{center}

\noindent where $n$ is the number of compartments and $k$ is the total number of wall surfaces ( $4n$ if all wall surfaces are solved for each compartment ).  In the simplest case, all temperatures are initialized to ambient, all pressures are initialized to zero, and $\vec{y}'$ is zero. For more complex cases, an initial $\vec{y}$ and $\vec{y}'$ at $t=0$ is calculated and supplied to DASSL. At each time step, the solver estimates values for $\vec{y}$ and $\vec{y}'$ at $t+\Delta t$, CFAST calculates an actual $\vec{y}'$ from the estimated values of $\vec{y}$ and returns the difference between the estimated $\vec{y}'$ and calculated $\vec{y}'$ to DASSL. DASSL uses an extension of Newton's method to approximate the derivatives using backward differentiation formulae of orders one through five to solve for $\vec{y}$ and $\vec{y}'$ to within tolerances specified by CFAST \cite{DASSL:1982,DASSL:1989}.

\section{Species Transport}

The equation of state, Eq. (\ref{EoS}), assumes that the molecular weight of the gaseous mixture throughout the domain is approximately that of air, 29~g/mol. However, CFAST does track the products of combustion and the depletion of oxygen in each zone. At the start of the simulation, the composition of each layer is set to ambient conditions. The initial temperature is specified by the user. The oxygen mass fraction is 23~\% (21~\% volume fraction) and the nitrogen mass fraction is 77~\% (79~\% volume fraction). The mass fraction of water vapor is specified by the user in terms of a relative humidity and the oxygen and nitrogen mass fractions are adjusted accordingly. All other gas species are initially zero.  As fuel is burned, product species are produced in direct proportion to the rate of fuel consumption (the major products of combustion are determined from the specified fuel molecule and the minor species yields are specified by the user). The mass fraction of oxygen can limit the combustion rate as discussed in Section~\ref{section:HRR}. Two special separate species are included in the model -- a generic toxic species and an arbitrary trace species. Both are excluded from the overall mass balance, but they are generated by the fire and transported in a manner identical to the other species.

Each unit mass of a species produced by a fire is carried in the flow to the various rooms and accumulates in the layers. The species mass divided by the layer volume is the mass concentration. Filters can be used in mechanical ventilation systems to remove species. The phenomenon has been implemented in CFAST to remove trace species and soot. It is implemented by modifying the source terms which describe gas flow. See Ref.~\cite{Jones:2008} for an example on the use of filtering.

The calculation of radiation exchange in CFAST also depends in part on the species concentrations calculated by the model (and thus the user inputs for species yields). There are two separate radiation calculations performed by CFAST. The first is for thermal radiation as part of the overall heat transfer calculation, discussed in Section~\ref{sec:Radiation}. The second is for visible light extinction to determine visibility, discussed in Section~\ref{Visibility}.

%
% -------------------  The Fire Plume ------------------------
%

\chapter{The Fire Plume}
\label{sec:TheFire}

Fires in CFAST are specified by the user in terms of a time-dependent heat release rate (HRR), an effective fuel molecule, and the yields of the products of incomplete combustion like soot and CO. Fires can be specified in multiple compartments and are treated as totally separate entities, with no interaction of the plumes. These fires are generally referred to as ``objects'' and can be ignited at a prescribed time, temperature or heat flux.

CFAST does not include a pyrolysis model to {\em predict}, as opposed to specify, the growth and spread of the fire. Rather, the transient pyrolysis rates for each fire are prescribed by the user. Whereas this approach does not directly calculate the increased pyrolysis due to radiative feedback from the flame or compartment, in theory these effects could be prescribed by the user. For larger fires, this can be an important consideration, and the specification used should reflect the actual conditions as closely as possible.

\section{Combustion Chemistry}

 The HRR of the fire is specified by the user, but it may be constrained by the availability of oxygen in the compartment. The combustion of a hydrocarbon fuel is described by the following single-step reaction:
\begin{eqnarray}
   \mathrm{C_{n_\C}H_{n_H}O_{n_O}N_{n_N}Cl_{n_{Cl}}} &+&  \nu_\OTWO \, \mathrm{O_2}  \rightarrow  \nonumber \\[.1in]
   \nu_\COTWO \, \mathrm{CO_2} &+& \nu_\HTWOO \, \mathrm{H_2O} \; + \; \nu_\CO \, \mathrm{CO} \; + \; \nu_\So \, \mathrm{Soot} \; + \; \nu_\HCl \mathrm{HCl} \; + \; \nu_\HCN \mathrm{HCN} \label{stoich}
\end{eqnarray}
The user specifies the composition of the fuel molecule and the yields of soot and CO, $y_\So$ and $y_\CO$, which are related to their stoichiometric coefficients as follows:
\begin{eqnarray}
   \nu_\So &=& \frac{M_\F}{M_\So} \; y_\So \label{soot_yield} \\[.1in]
   \nu_\CO &=& \frac{M_\F}{M_\CO} \; y_\CO \label{CO_yield}
\end{eqnarray}
Under the assumption that all of the nitrogen and chlorine in the fuel are converted to HCN and HCl, the other stoichiometric coefficients are:
\begin{eqnarray}
  \nu_\COTWO &=& \mathrm{n_\C} - \brackets{\nu_\CO + \nu_\HCN + \nu_\So} \\[.1in]
  \nu_\HTWOO &=& \frac{\mathrm{n_\Hy} - \brackets{\nu_\HCl + \nu_\HCN}}{2} \\[.1in]
  \nu_\OTWO  &=& \nu_\COTWO + \frac{\nu_\HTWOO + \nu_\CO - \mathrm{n_\Oh}}{2} \label{Oxygen_yield} \\[.1in]
  \nu_\HCl   &=& \mathrm{n_{Cl}} \\[.1in]
  \nu_\HCN   &=& \mathrm{n_{N}}
\end{eqnarray}
Note that the nitrogen in the air acts only as a diluent. The yields of hydrogen cyanide and hydrogen chloride are based solely on the composition of the fuel molecule. Finally, a user-specified trace species can be specified to follow the transport that results from fire-induced flow for an arbitrary species. This may be of particular interest for radiological releases \cite{Jones:2008}, but may be useful for any trace amounts released by a fire.



\section{Heat Release Rate}
\label{section:HRR}

As fuel and oxygen are consumed, heat is released and various products of combustion are formed. The heat is released as radiation and convected heat:
\begin{eqnarray}
   \dQr &=& \chir \, \dQ \\[.1in]
   \dQc &=& (1-\chir) \, \dQ \\
\end{eqnarray}
where $\dQ$ is the heat released by the fire. The parameters $\dQr$ and $\dQc$ are the heat released by radiation and convection, respectively, and $\chir$ is the fraction of the fire's heat release rate emitted as radiation.

The user specifies the heat release rate, $\dQ$, as the actual heat released, accounting for combustion efficiency, along with a characteristic base diameter, $D$, which is used in the plume temperature and mass entrainment correlations. The combustion efficiency, $\chia$, is the fraction of the theoretical energy that is actually released during combustion \cite{Hamins:1996}. $\chia$ is a function of fuel type, scale, and vitiation. For small fires, Tewarson provides measured values for specific fuels \cite{Tewarson:2003}. Within CFAST, the user also specifies a radiative fraction which takes a default value of 0.35 ; i.e., 35 \% of the fire's energy is released via radiation.  For specific fuels, the work of Tewarson \cite{Tewarson:2003}, McCaffrey \cite{McCaffrey:1982}, or Koseki \cite{Koseki:1989} is available for reference. The effects of scale, fuel type, vitiation, and combustion efficiency are all important to the radiation released by a fire \cite{Hamins:1991, Hamins:1994}. The typical range for the radiative fraction is from about 0.05 to 0.4. The assumed and constant values for the combustion efficiency and radiative fraction may add uncertainty to the calculated results, so the heat release rate and radiative fraction should be chosen carefully to best model the scenario of interest.

Using the specified heat release rate of the fire, $\dQ$, and a user-specified the heat of combustion, $\Dh$,  the model calculates the pyrolysis rate of fuel, $\dmf$:
\be
   \dmf = \frac{\dQ}{\Dh}
\ee

In the event that the HRR is constrained by the availability of oxygen, it is assumed that the pyrolysis rate does not change. However, only part of the pyrolyzed fuel burns and the HRR becomes:
\be
   \dQ = \min \Big( \dmf \, \Dh \, , \, \dme \, Y_\OTWO \, C_{\rm LOL} \, \DhO \Big)
\ee
where $\dme$ is the entrainment rate, $Y_\OTWO$ is the mass fraction of oxygen in the layer containing the fire, $\DhO$ is the heat of combustion based on oxygen consumption\footnote{The heat of combustion based on oxygen consumption is taken to be 13.1~MJ/kg, representative of typical hydrocarbon fuels~\cite{Huggett:1980}.}, and $C_{\rm LOL}$ (Lower Oxygen Limit) is the smoothing function ranging from 0 to 1:
\be
   C_{\rm LOL} \approx \frac{\tanh \Big( 800 (Y_\OTWO - Y_{\OTWO,{\rm l}}) - 4 \Big) + 1}{2}
\ee
The limiting oxygen mass fraction, $Y_{\OTWO,{\rm l}}$, is 0.15, by default. This value is not a function of temperature.

Any unburned fuel is tracked by the model, and transported to the upper layer via entrainment in the fire plume or to other compartments through any user-specified vents. Unburned fuel may burn in the upper layer or at vents if sufficiently hot and if additional oxygen is available.



\section{Plume Entrainment}

A fire pumps mass and energy from the lower layer into the upper layer. The vertical flow of mass through a horizontal plane at height $z$ above the base of the fire is called the mass entrainment rate, $\dme(z)$. The vertical flow of energy through this horizontal plane is given by $\dQ_{\rm c} + \dme(z) \, c_p \, \Tl$. The empirical correlation for the mass entrainment rate depends on whether the plume is unobstructed, against a wall, or in a corner.

\subsection{Unobstructed Plumes}

The plume mass entrainment, $\dme(z)$, at a height $z$ above the base of the fire is estimated using Heskestad's correlation~\cite{Heskestad:2002}:
\be
   \dme(z) = 0.196 \, \left( \frac{g \, \rho_\infty^2}{c_p \, T_\infty} \right)^{1/3} \, \dQ_{\rm c}^{1/3} \; \brackets{z - z_0}^{5/3} \;
   \left( 1 + \frac{2.9 \, \dQ_{\rm c}^{2/3}}{ \left( \sqrt{g} \, c_p \, \rho_\infty \, T_\infty \right)^{2/3} \, (z-z_0)^{5/3}} \right) \label{mdot_e}
\ee
where $z_0$ is a virtual origin defined as
\be
   \frac{z_0}{D} = -1.02 + 1.4 \, \dQ^{* \, 2/5} \quad ; \quad \dQ^* = \frac{\dQ}{\rho_\infty \, c_p \, T_\infty \, \sqrt{g \, D} \, D^2} \label{virtual_origin}
\ee
Note that the virtual origin is defined in terms of the total heat release rate of the fire, $\dQ$. Equation~(\ref{mdot_e}) is recommended above the mean flame height, $L$. Below the flame height, Heskestad~\cite{Heskestad:2002} recommends the following:
\be
  \dme(z) = \dme(L) \, \frac{z}{L} \quad ; \quad \frac{L}{D} = -1.02 + 3.7 \, \dQ^{* \, 2/5}
\ee
where the mean flame height is defined as the distance from the fuel source to the top of the visible flame where the intermittency is 0.5.  A flame intermittency of 0.5 means that the visible flame is above the mean 50~\% of the time and below the mean 50~\% of the time.

\subsection{Wall and Corner Plumes}

If the fire is located in a corner or against a wall\footnote{CFAST assumes that the fire is in a corner or against a wall {\em only} when the user specifies the {\em exact} coordinates of the corner or wall.}, the unobstructed plume entrainment correlation, Eq.~(\ref{mdot_e}), is modified. For a corner, it is assumed that the fire is mirrored in each wall face, quadrupling the convective HRR, $\dQ_{\rm c}$, and doubling the base diameter, $D$. The entrainment rate, $\dme(z)$, of this hypothetical larger fire is then divided by a factor of 4. The effective entrainment rate is approximately $4^{1/3}/4 \approx 0.40$ of its unobstructed value. Of course, the virtual origin, $z_0$, in Eq.~(\ref{mdot_e}) is affected by the change in effective diameter as well.

If the fire is against a wall, the convective HRR is doubled, the diameter is multiplied by $\sqrt{2}$, and the result of Eq.~(\ref{mdot_e}) is divided by 2. The effective entrainment rate is $2^{1/3}/2 \approx 0.63$ of its unobstructed value.

\subsection{Weak Plumes}

In CFAST, there is a constraint on the mass entrainment rate because the plume can rise only so high for a given HRR.  Early in a fire, the plume may not have sufficient energy to reach the compartment ceiling. Therefore, a limit is placed on the entrainment rate. For the plume to be able to penetrate the hot upper layer, the density of the gas in the plume must be less than the density of the gas in the upper layer. This implies that the upper layer temperature must be less than the plume temperature:
\be
   \Tu < \Tp \approx \frac{ \dQc + \dme \, c_p \, \Tl }{ \dme \, c_p}
\ee
Rearranging terms yields a limit on the mass entrainment:
\be
   \dm_e < \frac{\dQc}{c_p (\Tu - \Tl)}
\ee


\section{Plume Temperature and Velocity}
\label{sec:Plume_Temp_Velocity}

The centerline plume temperature rise, $\Delta T_0(z)$, and velocity, $u_0(z)$, at a height $z$ above the base of the fire is estimated using Heskestad's correlations~\cite{Heskestad:2002}:
\be
   \Delta T_0(z) = \min \left[ 900 \; \mathrm{K} \; , \; 9.1 \, \left( \frac{T_\infty}{g \, c_p^2 \, \rho_\infty^2} \right)^{1/3} \, \dQ_{\rm c}^{2/3} \, (z-z_0)^{-5/3} \right]  \label{plume_temperature}
\ee
\be
   u_0(z) = \min \left[ u_{0,\max} \; , \; 3.4 \, \left( \frac{g}{c_p \, \rho_\infty \, T_\infty} \right)^{1/3} \, \dQ_{\rm c}^{1/3} \, (z-z_0)^{-1/3} \right]  \label{plume_velocity}
\ee
where the virtual origin, $z_0$, is defined in Eq.~(\ref{virtual_origin}). It is assumed that the temperature and velocity decrease following a Gaussian profile about the centerline:
\be
   \Delta T(r,z) = \Delta T_0(z) \, \exp \left[ -\left( \frac{r}{\sigma_{\Delta T}} \right)^2 \right] \quad ; \quad \sigma_{\Delta T} = 0.14 \, \left( \frac{T_0(z)}{T_\infty} \right)^{1/2} \, (z-z_0) \label{plume_temperature2}
\ee
\be
   u(r,z) = u_0(z) \, \exp \left[ -\left( \frac{r}{\sigma_u} \right)^2 \right] \quad ; \quad \sigma_u \approx 1.1 \, \sigma_{\Delta T} \label{plume_velocity2}
\ee
Note that the maximum plume temperature of 900~K is suggested by Heskestad~\cite{Heskestad:2002}. It is also suggested that the maximum centerline plume velocity is reached when the plume temperature rise is 650~K, and is a weak function of the convective HRR:
\be
   u_{0,\max} = 2.2 \left( \frac{g^{2/5}}{T_\infty^{2/5} \, (c_p \, \rho_\infty)^{1/5} } \right) \, \left( 650 \, \dQ_{\rm c} \right)^{1/5}
\ee
Note that if the velocity is expressed in units of m/s and the convective HRR in kW, then $u_{0,\max} \approx 2 \; \dQ_{\rm c}^{1/5}$.

Above the interface between the hot upper layer and the cooler lower layer, the temperature and density of the entrained air is significantly different than that of the lower layer. To account for this, the plume temperature correlation~\cite{Heskestad:2002} is modified for values of $z$ greater than the interface height, $z_{\rm I}$:
\be
   \Delta T_0(z) = 9.1 \, \left( \frac{\Tu}{g \, c_p^2 \, \rho_{\rm u}^2} \right)^{1/3} \, \dQ_{\rm c}^{2/3} \, (z-z_0')^{-5/3}  \quad ; \quad z>z_{\rm I}  \label{plume_temperature_upper}
\ee
where the modified virtual origin is given by:
\be
   z_0' = z_{\rm I} - \left( \frac{\Tu}{\Tl} \right)^{3/5} \, (z_{\rm I}-z_0)  \label{virtual_origin_modified}
\ee
Equations~(\ref{plume_temperature_upper}) and (\ref{virtual_origin_modified}) are obtained by asserting that $\Delta T_0$ is continuous across the layer interface and that $\Tu \rho_{\rm u} \approx \Tl \rho_{\rm l}$.

The mass entrainment correlation, Eq.~(\ref{mdot_e}), is modified the same way above the layer interface.

%
% -------------------  Ventilation ------------------------
%

\chapter{Ventilation}

CFAST models three types of vent flow: natural flow through vertical vents (such as doors or windows),  natural flow through horizontal vents (such as ceiling holes or hatches), and forced flow via mechanical ventilation. Forced flow can occur through either vertical or horizontal vents.


\section{Vertically-Oriented Vents (Doors and Windows)}

Natural flow through windows and doors is governed by the vertical stratification of the pressure difference across the opening~\cite{Emmons:SFPE}. The mass flow is calculated by dividing the opening into discrete horizontal segments, each of which is bounded by the top or bottom of the opening, the zone interface of either compartment, or the neutral plane, which is where the velocity changes direction. This is shown schematically in Fig.~\ref{fig:Flow_Patterns}.

\begin{figure}[t]
\setlength{\unitlength}{1in}
\begin{picture}(6.5,4)
\thicklines
\put(0,0){\line(1,0){6.5}}
\put(0,4){\line(1,0){6.5}}
\put(3.25,4){\line(0,-1){1}}
\thinlines
\put(0,1.5){\line(1,0){3.25}}
\put(3.25,2.5){\line(1,0){3.25}}
\put(0,2.0){\line(1,0){6.5}}
\put(3.5,0.75){\vector(-1,0){0.5}}
\qbezier(3.5,1.75)(3.25,1.75)(3.0,1.5)
\put(3.0,1.5){\vector(-1,-1){0.2}}
\qbezier(3,2.25)(3.25,2.25)(3.5,2.5)
\put(3.5,2.5){\vector(1,1){0.2}}
\put(3,2.75){\vector(1,0){0.5}}

\put(1.625,3.8){\makebox(0,0){Compartment 1}}
\put(4.875,3.8){\makebox(0,0){Compartment 2}}
\put(6,1.85){\makebox(0,0){Neutral Plane}}
\put(5.95,2.35){\makebox(0,0){Layer Interface}}
\put(0,1.35){Layer Interface}
\put(3.75,0.75){\makebox(0,0){$\dm_{\rm l \to l}$}}
\put(3.75,1.75){\makebox(0,0){$\dm_{\rm l \to u}$}}
\put(2.75,2.25){\makebox(0,0){$\dm_{\rm u \to l}$}}
\put(2.75,2.75){\makebox(0,0){$\dm_{\rm u \to u}$}}

\end{picture}
\caption{Flow patterns for horizontal flow through a vertical vent.}
\label{fig:Flow_Patterns}
\end{figure}

Let $z=b$ and $z=t$ denote the height of the bottom and top of the segment, and $\Delta P_b$ and $\Delta P_t$ denote the pressure differences at these heights.  Because a given segment is either completely above or completely below the neutral plane, the two pressure differences will have the same sign. The mass flow through the segment can then be computed by integrating Bernoulli's equation from $b$ to $t$:
\begin{eqnarray}
\dm &=& \int_b^t C \sqrt{2 \rho \, \Delta P(z)} \, w \; \rd z  \\[.1in]
    &=& C\sqrt{2\rho} \, w \int_b^t\sqrt{\frac{|(t-z) \, \Delta P_b + (z-b) \, \Delta P_t|}{t-b}} \; \rd z \\[.1in]
    &=& \frac{2}{3} \, C \sqrt{2\rho} \, w \, (t-b)\frac{|\Delta P_t|^{3/2}-|\Delta P_b|^{3/2}}{|\Delta P_t|-|\Delta P_b|}
\label{eq:massflowone}
\end{eqnarray}
Here, $C$ is the orifice coefficient taken to be 0.7~\cite{Steckler_Coefficients}, $\rho$ is the gas density of the upwind compartment, $w$ is the width of the opening, and $\Delta P(z)$ is the pressure across the interface at elevation $z$. Note the use of the integral formula
\begin{eqnarray}
\int \sqrt{A+Bz} \; \rd z = \frac{2}{3B}(A+Bz)^{3/2}+\mbox{constant}
\end{eqnarray}
where $A=(|t\,\Delta P_t|-b\,|\Delta P_b|)/(t-b)$ and $B=(|\Delta P_t|-|\Delta P_b|)/(t-b)$. Equation~\ref{eq:massflowone} can be written:
\be
   \dm = \frac{2}{3} C \sqrt{2 \rho} \, w \, (t-b)  \frac{|\Delta P_t|+\sqrt{|\Delta P_t \,\Delta P_b|}+|\Delta P_b|}{\sqrt{|\Delta P_t|}+\sqrt{|\Delta P_b|} }
\ee
This is the way it is written in Ref.~\cite{Emmons:SFPE}.

Figure~\ref{fig:Flow_Patterns} indicates schematically how the various mass flows through the opening are distributed. For the flow originating in the upper layer of the upstream compartment flowing into the upper layer of the downstream compartment, $\dm_{\rm u \to u}$, or the flow from the lower layer to the lower layer, $\dm_{\rm l \to l}$, the mass is applied directly to the downstream layer.

The mass flow from the upper layer of the upstream compartment to the lower layer of the downstream, $\dm_{\rm u \to l}$, is assumed to rise into the upper layer via a spill plume. The heat flow rate of the plume is:
\be
   \doh_{\rm u \to l} = c_p \brackets{T_{\rm u,1}-T_{\rm l,2}} \, \dm_{\rm u \to l}
\ee
Assuming that $T_{\rm u,1} > T_{\rm l,2}$, the mass entrainment of the spill plume is given by Poreh {\em et al.}~\cite{Poreh:1998}:
\be
   \dm_{\rm e,p} = \dm_{\rm u \to l} \, + \, C_{\rm m} \, \left( \frac{T_{\rm l,2}}{T_{\rm u,1}} \right)^{2/3} \, \left( \frac{ g \, \rho_{\rm l,2}^2}{c_p \, T_{\rm l,2}} \right)^{1/3} \, \doh_{\rm u \to l}^{1/3} \; w^{2/3} \;
   (z_{\rm I}-z_{\rm N})
\ee
where $C_{\rm m}$ is an empirical constant equal to 0.44, $w$ is the width of the opening, $z_{\rm I}$ is the height of the layer interface, and $z_{\rm N}$ is the height of the neutral plane. Suggested values for $C_{\rm m}$ vary between 0.44 and 0.66, all of which were determined empirically in a number of different experimental configurations.

For the mass flow leaving the lower layer of the upstream compartment and entering the upper layer of the downstream compartment, $\dm_{\rm l \to u}$, the shear flow causes vortex shedding that entrains upper layer gas and deposits it in the lower layer. It is assumed that the incoming cold plume behaves like the inverse of the usual door jet between adjacent hot layers; forming a descending plume.  The same equations are used to calculate this inverse plume as are used for the upright door mixing, above.

\section{Horizontally-Oriented Vents (Ceiling Vents)}

Cooper~\cite{Cooper:1989} developed a semi-empirical correlation for ceiling vents in which the volumetric flow rates upwards and downwards are functions of both pressure and density differences:
\begin{eqnarray}
   \dot{V}_{\rm up}   &=&  0.68 \, A_{\rm v} \, \sqrt{ 2 \, |\max(\Delta P,0)|/\rho_{\rm bot} } + \dot{V}_{\rm ex}  \\[.1in]
   \dot{V}_{\rm down} &=&  0.68 \, A_{\rm v} \, \sqrt{ 2 \, |\min(\Delta P,0)|/\rho_{\rm top} } + \dot{V}_{\rm ex}
\end{eqnarray}
Here, $\Delta P$ is the  lower {\em compartment} pressure minus the upper, $A_{\rm v}$ is the area of the vent, and $\rho_{\rm top}$ and $\rho_{\rm bot}$ are the {\em layer} densities adjacent to the vent. The term, $\dot{V}_{\rm ex}$, represents the density-driven {\em exchange} flow; that is, when $\Delta \rho=\rho_{\rm top}-\rho_{\rm bot}>0$ and $|\Delta P|$ is relatively small, there is an exchange of mass and heat at the vent interface where hot gas from below mixes with cooler gases above:
\be
   \dot{V}_{\rm ex} = 0.10 \, \left( \frac{g \, \Delta \rho \, A_{\rm v}^{5/2}}{\rho_{\rm avg}} \right)^{1/2} \left( 1 - \frac{|\Delta P|}{|\Delta P_{\rm \tiny flood}|} \right) \quad ; \quad
   |\Delta P| < |\Delta P_{\rm \tiny flood}| \equiv \frac{C_{\rm s}^2 \, g \, \Delta \rho \, D^5}{2 \, A_{\rm v}^2 }
\ee
Here, $\rho_{\rm avg}$ is the average of the densities above and below the vent,   $D = 2 \sqrt{A_{\rm v} / \pi}$, and the shape factor, $C_{\rm s}$, is 0.754 for round and 0.942 for square openings.

As with doors and windows, mass and heat exchanged between the layers of the upper and lower compartments. Take the typical case where the lower compartment has a hot gas layer venting into the upper compartment. Consider first the relative amounts of mass and heat extracted from the layers of the lower compartment, and then consider where this mass and heat are deposited in the upper compartment. First, the mass and heat are extracted from the lower and upper layers of the lower compartment according to the following weighted average:
\begin{eqnarray}
  \dm_{\rm up}  &=& \alpha \; \rho_{\rm u} \, \dot{V}_{\rm up} + (1-\alpha) \; \rho_{\rm l} \, \dot{V}_{\rm up}  \\[.1in]
  \doh_{\rm up} &=& \alpha \; c_p \, \rho_{\rm u} \, \dot{V}_{\rm up} \, \Tu + (1-\alpha) \; c_p \, \rho_{\rm l} \, \dot{V}_{\rm up} \, \Tl
\end{eqnarray}
where $\rho_{\rm u}$ and $\rho_{\rm l}$ refer to the upper and lower layers of the lower compartment.

The weighting factor, $\alpha$, indicates the relative amounts of mass extracted from the upper and lower layers of the lower compartment. If the hot gas layer of the lower compartment is sufficiently deep, all of the gas passing into the upper compartment is extracted from the upper layer. If the layer is not sufficiently deep, gases from the lower layer are also drawn through the vent, which reduces the amount of smoke that is exhausted from the compartment. This phenomenon is referred to as plug-holing. Cooper~\cite{Cooper:SFPE} suggests that the degree of plug-holing is a function of the following form of the Froude number:
\be
   {\rm Fr} = \dot{V} \; \left[ g \, (H-z_{\rm I})^5 \, \left( \frac{\Tu-T_\infty}{T_\infty}\right) \right]^{-1/2}
\ee
where $\dot{V}$ is the volume flow through the vent and $(H-z_{\rm I})$ is the depth of the hot gas layer. Using the CFD model Fire Dynamics Simulator (FDS), a correlation was developed that defines $\alpha$ as a function of Fr:
 \begin{equation}
 \label{equation1}
  \alpha =  {\rm e}^{-( {\rm Fr}/2 )^2}
\end{equation}
Figure~\ref{correlation} displays the FDS results and correlation.
\begin{figure}[!ht]
\label{correlation}
\centering
\includegraphics[width=3.0in]{FIGURES/Vent_Mass_Fraction}
\caption[Relative fraction of upper layer gases extracted via a ceiling vent]{Relative fraction of upper layer gases extracted via a ceiling vent.}
\end{figure}

The previous paragraph explains from where the gas flowing through the vent is extracted. Where the gas goes is more simple. If the temperature of the hot gas layer of the lower compartment is greater than the temperature of the lower layer of the upper compartment, then the mass and heat are deposited into the upper layer of the upper compartment. Otherwise, the mass and heat are deposited into the lower layer of the upper compartment.


\section{Forced Flow}

CFAST models mechanical ventilation in terms of user-specified volume flows at various points in the compartment. The model does not include duct work or fan curves. These equations are high-order, non-linear and in some cases ill-posed, which caused a great deal of difficulty in reaching a numerical solution.

The flow through mechanical vents can be filtered. Filtering affects particulates such as smoke and the trace species. Filtering can be turned on at any time. Effectiveness is from 0~\% (no effect) to 100~\% which completely blocks the flow of these two species.

%
% -------------------  Heat Transfer ------------------------
%

\chapter{Heat Transfer}

This section discusses thermal radiation, convection, and conduction, the three mechanisms by which heat is transferred between the gas layers and the enclosing compartment walls. Hot gases exchange heat with solid surfaces via convection and radiation. Heat is transferred through solids via conduction. Different material properties can be used for the ceiling, floor, and walls of each compartment (although all the walls of a compartment must be the same).  Additionally, each surface can be composed of up to three distinct layers.  This allows the user to deal naturally with the actual building construction.  Material thermophysical properties are assumed to be constant. Radiative transfer occurs among the fire(s), gas layers and compartment surfaces (ceiling, walls and floor).  This transfer is a function of the temperature differences and the emissivity of the gas layers as well as the compartment surfaces.  Typical surface emissivity values only vary over a small range.  For the gas layers, however, the emissivity is a function of the concentration of species which are strong radiators, predominately smoke particulates, carbon dioxide, and water.

\section{Radiation}
\label{sec:Radiation}

Radiation heat transfer is calculated between the ceiling, floor, wall layers, and fire, with the inclusion of emission and absorption by the hot gas layer~\cite{Forney_radiation}. The following assumptions are made:
\begin{itemize}
\item Each gas layer and each wall segment is assumed to be at a uniform temperature.
\item The wall and gas layer temperatures are assumed to change slowly over the duration of the time step of the governing equations.
\item The fire is assumed to radiate uniformly in all directions emitting a fraction, $\chi_{\rm r}$, of the total heat release rate.  This radiation is assumed to originate from a single point.  Radiation feedback to the fire and radiation from the plume is not modeled in the radiation exchange algorithm.
\item The radiation emitted is assumed to be diffuse and gray.  In other words, the radiant fluxes emitted are independent of direction and wavelength. At a solid surface, the emittance, $\epsilon$, absorptance, $\alpha$, and reflectance, $\rho$, are related via $\epsilon = \alpha = 1 - \rho$. In the gas phase, the emittance, $\epsilon$, absorptance, $\alpha$, and transmittance, $\tau$, are related via $\epsilon = \alpha = 1 - \tau$.
\item Rooms or compartments are assumed to be rectangular boxes.  Each wall is either perpendicular or parallel to every other wall.  Radiation transfer through vent openings is lost from the room.
\end{itemize}

% define commands for qin and qout to make it easier to change/improve notation
\newcommand{\qout}[1]{q_{{\rm out},#1}''}
\newcommand{\qin}{q_{{\rm in},i}''}

The compartment lining is divided into four surfaces: the ceiling, the floor, and the wall sections above and below the layer interface.  The outgoing radiant flux at surface $i$ consists of an emissive power and reflectance term given by
\be
\qout{i}=\sigma\epsilon_i T_i^4+\left(1-\epsilon_i\right)\qin
\label{eq:qout}
\ee
where $\qin$ is a weighted average of all outgoing radiant fluxes from sources such as wall segments, gas layers and fires.  This incoming radiant flux is given by
\be
\qin=\left(\frac{1}{A_i}\sum_{j=1}^4A_j\qout{j} \, F_{j-i} \, \tau_{j-i}\right)+c''_i
\ee
which simplifies to
\be
\qin=\left(\sum_{j=1}^4\qout{j} \, F_{i-j} \, \tau_{j-i}\right)+c''_i
\label{eq:qin}
\ee
after noting that $A_iF_{i-j}=A_jF_{j-i}$.
The term $F_{j-i}$ is the configuration factor (fraction of radiant energy emitted by surface $j$ that is intercepted by surface $i$), $\tau_{j-i}$ is the transmittance, $\sigma$ is the Stefan-Boltzman constant, $\epsilon_i$ is the emissivity, $T_i$ is the temperature  and $c_i''$ is the radiative flux from gas layers and fire of surface $i$ .

The problem then is to determine the net radiative flux, $\dot{q}_{{\rm r},i}''$, at each of these surfaces.  This flux is defined as the difference between the incoming and outgoing radiative flux\footnote{The sign for the net radiative flux, $\dot{q}_{{\rm r},i}''$, is defined so that positive radiant fluxes heat up wall segments, consistent with how convective fluxes are defined.  Note that this is opposite to the sign convention used in Siegel and Howell~\cite{SiegelandHowell:1981}.}:
\be
\dot{q}_{{\rm r},i}'' = \qin - \qout{i}
\label{eq:raddiff}
\ee
Following Eq.~(17-20) in Siegel and Howell~\cite{SiegelandHowell:1981}, Eq.~(\ref{eq:raddiff}) is written as a system of four linear equations (after using Eqs.~(\ref{eq:qout}) and (\ref{eq:qin}) to eliminate $\qout{i}$ and $\qin$):
\be
   -\frac{\dot{q}_{{\rm r},i}''}{\epsilon_i} + \displaystyle\sum_{j=1}^4 \frac{1 - \epsilon_j}{\epsilon_j} \;  F_{i-j} \; \tau_{j-i} \; \dot{q}_{{\rm r},j}'' = \sigma T_i^4 - \displaystyle\sum_{j=1}^4 \brackets{F_{i-j} \; \tau_{j-i} \; \sigma T_j^4 \, } - c''_i \label{RTE}
\ee
The radiation from the gases in the upper and lower layers and the fire is included in the last term:
\be
   c''_i = \displaystyle\sum_{j=1}^2 \epsilon_j \, F_{i-j} \, \sigma \, T_j^4 + \frac{\omega_{i-{\rm f}}}{A_i} \frac{\chi_{\rm r} \, \dQ}{4 \pi} \label{ckeq}
\ee
where $\epsilon_{\rm j}$ is the emittance (absorptance) of the layer, $F_{i-j}$ is the view factor between the layer and solid surface, $\omega_{i-{\rm f}}$ is the {\em normalized} solid angle between the fire and wall\footnote{Note that as the area of surface $i$ shrinks to zero, $\omega_{i-{\rm f}}/A_i \to 1/R^2$, yielding the classic point source radiation model.}, and $\dQ$ is the heat release rate of the fire. If the solid surface, $i$, is the floor or the lower wall and the gas layer, $j$, is the upper layer, the view factor, $F_{i-j}$, refers to the layer interface. If the solid surface is the upper wall or ceiling, the view factor is 1. Eq.~(\ref{RTE}) is a set of linear equations (4 equations and 4 unknowns) whose solution is discussed in the next section.

The net radiative flux, $\dq_{{\rm r},i}''$ found in Eq.~(\ref{RTE}), along with the convective flux discussed in Section~\ref{section:convection}\ is used as a boundary condition for computing heat conduction within the solid walls. The outgoing radiative flux, $\qout{i}$ is used in Section~\ref{section:target} for computing radiative flux to a target.  It may be rewritten in terms of known quantities, in particular the net radiative flux found in Eq. (\ref{RTE}), by eliminating $\qin$ in Eqs.~\ref{eq:qout} and~\ref{eq:raddiff} and is given by
\be
\qout{i}=\sigma T_i^4+\frac{1-\epsilon_i}{\epsilon_i}\dq_{{\rm r},i}''
\label{eq:qoutb}
\ee

%%

\subsection{Solving the Radiation Equations}

Equation~(\ref{RTE}) is a system of linear equations of the form
\begin{equation}
   \mathbf{A \, q} = \mathbf{B \, e - c}
\label{eq:linearsystem}
\end{equation}
where $\mathbf A$ and $\mathbf B$ are $4\times 4$ matrices, $\mathbf q$ is the unknown vector of net radiative fluxes, and $\mathbf e$ is the vector of emission terms:
\begin{eqnarray}
a_{ij}  &=& \delta_{ij} - F_{i-j} \, \tau_{i-j} \, (1-\epsilon_j) \\
b_{ij}  &=& \delta_{ij} - F_{i-j} \, \tau_{i-j} \\
q_j     &=& -\dot{q}_{{\rm r},j}''/\epsilon_j \\
e_j     &=& \sigma \, T_j^4
\end{eqnarray}
The components of the source term vector, $c_j$, are given by Eq.~(\ref{ckeq}).  The term $\delta_{ij}$ is the usual Kronecker delta function:
\begin{eqnarray*}
\delta_{ij}=\left\{
\begin{array}{cc}
1&i=j\\
0&i\ne j
\end{array}
\right.
\end{eqnarray*}



\subsection{Configuration Factors}

The configuration factor, $F_{i-j}$, is the fraction of radiant energy emitted by surface $i$ that is intercepted by surface $j$.  Sixteen configuration factors are required for each compartment. Figure~\ref{configfactorsetup} depicts the system of indices for the wall surfaces and layer interface. In general, these factors may be computed using
\be
   F_{i-j} = \frac{1}{A_i} \int_{A_i} \int_{A_j} \frac{\cos \theta_i \, \cos \theta_j}{\pi L^2} \, dA_j \, dA_i \label{eq:config_factor}
\ee
where $L$ is the distance along the line of integration,  $\theta_i$ and $\theta_j$ are the angles for surface $i$ and $j$ between the respective normal vectors and the line of integration, and $A_i$ and $A_j$ are the areas of the two surfaces.

\begin{figure}[!ht]
\centering
\setlength{\unitlength}{1in}
\begin{picture}(3,2)
\thicklines
\put(0,0){\framebox(3,2){ }}
\thinlines
\put(0,1.5){\dashbox{0.1}(3,.5){ }}
\put(1.5,0.1){\makebox(0,0){4 - Floor}}
\put(1.5,1.35){\makebox(0,0){d - Layer Interface}}
\put(1.5,1.85){\makebox(0,0){1 - Ceiling}}
\put(0.1,0.7){\makebox(0,0)[l]{3 - Lower Wall}}
\put(0.1,1.7){\makebox(0,0)[l]{2 - Upper Wall}}
\end{picture}
\caption{Schematic diagram of a compartment with indices for computing configuration factors.}
\label{configfactorsetup}
\end{figure}

A more efficient procedure is to compute configuration factors between the ceiling and floor, $F_{1-4}$, between the ceiling and layer interface, $F_{1-d}$, and between the floor and layer interface, $F_{4-d}$, using a formula for the configuration factor between parallel plates (Appendix~C of Ref.~\cite{SiegelandHowell:1981}):
\begin{eqnarray}
\lefteqn{F_{i-j} = \frac{2}{\pi \, X \, Y} \left\{ \ln \left[ \frac{(1+X^2)(1+Y^2)}{1+X^2+Y^2} \right]^{1/2} + X \sqrt{1+Y^2} \, \tan^{-1} \frac{X}{\sqrt{1+Y^2}} + \right.} \nonumber \\[.1in]
& \quad \quad \quad \quad \quad \quad & \left. Y \sqrt{1+X^2} \, \tan^{-1} \frac{Y}{\sqrt{1+X^2}} - X \, \tan^{-1} X - Y\, \tan^{-1} Y \right\}
\label{eq:configrect}
\end{eqnarray}
where $a$ and $b$ are the rectangle dimensions, $c$ is the separation distance, $X=a/c$ and $Y=b/c$. Algebraic relations in terms of $F_{1-4}$, $F_{1-d}$ and $F_{4-d}$ may then be used to determine the 16 required configuration factors.  Two properties are used to derive these relations.  First, the symmetry relation,
\begin{equation}
   A_i \, F_{i-j}=A_j \, F_{j-i}
   \label{symrel}
\end{equation}
follows from Eq.~(\ref{eq:config_factor}). Second, configuration factors for surfaces forming an enclosure satisfy
\begin{equation}
   \sum_{j=1}^4F_{i-j}=1
   \label{eq:factorsum}
\end{equation}
The configuration factor $F_{1-4}$ does not change during a simulation since its value depends only on the compartment height and floor/ceiling area. Therefore, $F_{1-4}$ need only be computed once. Configuration factors $F_{1-d}$ and $F_{4-d}$ depend on the layer interface height so need to be determined each time the radiation exchange is calculated.

$F_{1-4}$, $F_{1-d}$ and $F_{4-d}$ are determined using Eq.~(\ref{eq:configrect}). Since $A_1 = A_4$ it follows that $F_{4-1} = F_{1-4}$. The other 14 configuration factors can be calculated using simple algebraic formulas.
Since the floor and the ceiling are assumed to be flat rectangular surfaces, it follows that $F_{1-1}=F_{4-4}=0$. From Eq.~(\ref{eq:factorsum}) and the symmetry condition, $F_{2-1}=F_{2-d}$, it follows that
\begin{eqnarray}
\label{eq:config1}
   F_{1-2} + F_{1-d} &=& 1\\
   F_{2-1}+F_{2-2} + F_{2-d} &=& 2 \, F_{2-1}+F_{2-2}=2 \, \frac{A_1}{A_2} \, F_{1-2}+F_{2-2}=1
   \label{eq:config2}
\end{eqnarray}
Solving equations (\ref{eq:config1}) and (\ref{eq:config2}) for $F_{1-2}$ and $F_{2-2}$ gives
\begin{eqnarray*}
F_{1-2}&=&1-F_{1-d}\\
F_{2-2}&=&1-2 \, F_{2-1}
\end{eqnarray*}
Similarly,
\begin{eqnarray*}
F_{4-3}&=&1-F_{4-d}\\
F_{3-3}&=&1-2 \, F_{3-4}
\end{eqnarray*}
Using the above configuration factors and Eq.~(\ref{eq:factorsum}), it follows that
\begin{eqnarray*}
F_{1-3}&=&1-F_{1-4} - F_{1-2} \\
F_{3-2}&=&1-F_{3-1} - F_{3-3} - F_{3-4} \\
F_{2-4}&=&1-F_{2-1} - F_{2-2} - F_{2-3}
\end{eqnarray*}

\subsection{Solid Angles}

The normalized solid angle $\omega$ in Eq.~(\ref{ckeq}) is the view factor between a given point, say the fire, and a solid wall. In other words, it is the fraction of radiant energy emitted by the fire that is intercepted by a particular wall surface. Normalized solid angles are also used to determine the fraction of radiation from each wall surface that strikes a target as in Eq.~(\ref{target_rad}).

\begin{figure}[!ht]
\centering
\setlength{\unitlength}{1in}
\begin{picture}(3,2)
\thicklines
\put(0,.5){\framebox(3,1.5){ }}
\put(1,0){\vector(-2,1){1}}
\put(1,0){\vector(-1,2){1}}
\put(1,0){\vector(1,1){2}}
\put(0.4,0.2){\makebox(0,0){$\mathbf{v}_1$}}
\put(0.4,1.0){\makebox(0,0){$\mathbf{v}_2$}}
\put(2.4,1.2){\makebox(0,0){$\mathbf{v}_3$}}
\end{picture}
\caption{Solid angle formed by the vectors $\mathbf{v}_1$, $\mathbf{v}_2$, and $\mathbf{v}_3$.}
\label{solidanglesetup}
\end{figure}

To compute a solid angle, consider the triangle defined by the vertices $\mathbf{v}_1$, $\mathbf{v}_2$, and $\mathbf{v}_3$ as illustrated in Fig.~\ref{solidanglesetup}. The solid angle of this triangle with respect to the origin is computed
\begin{eqnarray*}
\omega = \frac{1}{2\pi} \; \tan^{-1} \left( \frac{|\hat{\mathbf v}_1\times \hat{\mathbf v}_2\cdot \hat{\mathbf v}_3|}
   {1+\hat{\mathbf v}_1\cdot \hat{\mathbf v}_2+\hat{\mathbf v}_1\cdot \hat{\mathbf v}_3+\hat{\mathbf v}_2\cdot \hat{\mathbf v}_3} \right)
\end{eqnarray*}
where $\hat{\mathbf v}$ denotes the normalized vector~\cite{vanOosterom:1983}. The normalized solid angle for a rectangular wall surface is computed by splitting the surface into two triangles, computing the solid angle for each triangle and summing.

\subsection{Transmittance and Absorptance}

The transmittance is the fraction of radiant energy that will pass through a volume filled with an absorbing medium. It is usually expressed in the form:
\be
   \tau = {\rm e}^{-a L}
\ee
where $a$ is the absorption coefficient and $L$ is the path length. The absorptance is the fraction of radiant energy absorbed by that volume. For a gray gas, $\alpha + \tau = 1$.

In general, the transmittance and absorptance are functions of wavelength. This is an important factor to consider for the major gaseous products, $\textnormal{CO}_2$  and $\textnormal{H}_2 \textnormal{O}$. However, soot has a continuous absorption spectrum that allows the transmittance and absorptance to be approximated as ``gray'' \cite{SiegelandHowell:1981} across the entire spectrum. The total transmittance over a path length $L$ through a volume of combustion products is taken as the product of the transmittance of the soot and major gas phase products:
\be
   \tau = e^{-a_{\rm s}L} \brackets{1 - \alpha_{\rm H_2O} - 0.5 \, \alpha_{\rm CO_2}}
\ee
The factor of 0.5 applied to the absorptance of CO$_2$ accounts for the overlap of the wavelength bands of the two gases. Tien~et~al.~\cite{Tien:2002} suggest that the absorption coefficient for soot may be approximated as $a_{\rm s} = k f_v T$ where $k$ is a constant that depends on the optical properties of the soot particles, $f_v$ is the soot volume fraction, and $T$ is the (absolute) temperature. Values of $k$ have been found to be about constant for a wide range of fuels~\cite{Tien:1978}.

Absorptance data for $\textnormal{H}_2 \textnormal{O}$ and $\textnormal{CO}_2$ are reported in Ref.~\cite{Edwards:1985}. For each gas, these data are tabulated and implemented as a two-dimensional array based on temperature and gas concentration.

The effective path length, $L$, is calculated between the center-points of the exchanging surfaces ({\em i.e.}, from the center height of a fire to the center of a wall surface or between the center points of two compartment surfaces). Path lengths are calculated separately for the upper and lower layers in a compartment.

\subsection{Radiation Heat Flux to a Target}
\label{section:target}

Objects, often referred to as ``targets,'' may be added to any compartment  to represent measurement devices or equipment that might be damaged in a fire. Targets absorb thermal radiation from the fire, walls and hot gas layer, but targets do not affect the fire simulation. That is, there is a one-way coupling between the target and the fires, 10 compartment surfaces (ceiling, floor, 4 walls--upper and lower) and 2 gas layers. The net radiative heat flux to a target is given by:
%\begin{split}
%   \dq_{\rm r}'' = \epsilon_{\rm t} & \left( \displaystyle\sum_{{\rm f}=1}^{n_{\rm fires}} \cos(\theta_{\rm f}) \tau_u \tau_l \; \frac{\chi_{\rm r} \, \dQ_{\rm f}}{4 \pi R_{\rm f}^2} +
%     \displaystyle\sum_{w=1}^{10} \tau_u \tau_l \, F_w \, \epsilon_w \, \qout{w} \right. + \\
%    & \left. \displaystyle\sum_{w=1}^5 \sigma \, F_w \, \left(T_{\rm l}^4 \alpha_l \tau_u + T_{\rm u}^4 \alpha_u\right) + \displaystyle\sum_{w=5}^{10} \sigma \, F_w \, \left(T_{\rm u}^4 \alpha_u \tau_l + T_{\rm l}^4 \alpha_l\right) -
%     \sigma T_{\rm t}^4 \right)
%\end{split}
\be \label{target_rad}
\begin{split}
   \dq_{\rm r}'' = \epsilon_{\rm t} & \left( \displaystyle\sum_{{\rm f}}^{{\rm fires}}
   \frac{\cos(\theta_{\rm f})}{4 \pi R_{\rm f}^2} \tau_u \tau_l \; \chi_{\rm r} \, \dQ_{\rm f} +
   \displaystyle\sum_{w}^{\rm walls} \tau_u \tau_l \, F_w \, \epsilon_w \, \qout{w} \right. + \\
    & \left. \frac{\cos(\theta_t)}{4\pi R_t^2}\tau_u \alpha_l \sigma T_l^4  + \frac{\cos(\theta_t)}{4\pi R_t^2}\tau_l \alpha_u\sigma T_u^4 - \sigma T_t^4 \right)
\end{split}
\ee

where $\epsilon_{\rm t}$ is the emissivity of the target, $\epsilon_{\rm w}$ is the emissivity of the wall surface, $\theta_{\rm f}$ is the angle formed by the line of sight segment (between the fire $\rm f$ and the target) of length $R_{\rm f}$ and the normal direction to the target surface, $F_{\rm w}$ is the view factor for the wall surface, $\tau_{\rm u}$ and $\tau_{\rm l}$ are the values of transmittance for the path between the target and the fires or walls in the upper and lower layers, $\alpha_{\rm u}$ and $\alpha_{\rm l}$ are $\left( 1-\tau_{\rm u} \right)$ and $\left( 1-\tau_{\rm l} \right)$, and $T_{\rm t}$ is the temperature of the target.  The term $\qout{\rm w}$, given by Eq.~(\ref{eq:qoutb}), is the outgoing radiative flux at the $\rm w$'th wall surface.



\section{Convection}
\label{section:convection}

The transfer of heat between the gas and solid surfaces is handled slightly differently at the ceiling, floor and walls, due to the difference in orientation and the presence of a relatively thin hot flow near the ceiling known as the ceiling jet. The following two sections describe how the convective heat transfer is done for these different surfaces.

\subsection{Walls and Floor}

In general, the convective heat flux to a solid surface is given by:
\be
   \dqc'' = h \, \brackets{\Tg - \Ts}  \label{convective_heat_flux}
\ee
The convective heat transfer coefficient, $h$, is a function of the gas properties, temperature, and velocity. In CFAST, simple correlations for natural convection are used, since the gas velocity is unknown:
\be
   h = C {|\Tg - \Ts|}^{1/3}
\ee
where $C$ is an empirical coefficient (1.52 for the floor and ceiling (in the absence of a ceiling jet) and 1.31 for the walls~\cite{Holman:1990}), $\Tg$ is the average gas layer temperature adjacent to the surface, and $\Ts$ is the surface temperature.

\subsection{Ceiling}

During the early stage of a fire before a hot gas layer has formed, the convective heat transfer to the ceiling is governed by the temperature and velocity of the ceiling jet. Alpert's chapter in the {\em SFPE Handbook}~\cite{Alpert:SFPE} presents an empirical correlation for the convective heat flux from the ceiling jet to a relatively cool surface:
\be
   \dqc'' = 1.323 \, f \, \frac{\dQ_{\rm c}}{H^2} \, \left( \frac{r}{H} \right)^{-1.36}  \label{eq:cjflux}
\ee
where $f$ is a friction factor estimated to be 0.03, $r$ is the radial distance to the plume centerline, $H$ is the ceiling height, and $\dQ_{\rm c}$ is the convective fraction of the heat release rate. The average convective heat flux to the ceiling can be obtained by integrating this expression over the entire ceiling:
\be
   \dq_{\rm c,avg}'' = \frac{1}{LW} \int_0^{2\pi} \int_0^R \dqc'' \, r \, dr \, d\theta = \frac{0.27 \, \dQ_{\rm c}}{(LW)^{0.68} \, H^{0.64}} \label{eq:cjfluxavg}
\ee
Note that the integration is carried out over a circle whose area, $\pi R^2$, is taken as equal to the area of the ceiling, $LW$.

Equation~(\ref{eq:cjfluxavg}) applies to the early stage of the fire; thus, a modified heat transfer coefficient is used so that there is a transition from the early to later stages when a layer has formed:
\be
   h = \max \left( \frac{\dq_{\rm c,avg}''}{\Tu-\Ts} \, , \, C {|\Tu - \Ts|}^{1/3} \right)
\ee
Here, $\Tu$ is the average temperature of the upper layer and $\Ts$ is the ceiling surface temperature. Notice that the rightmost term is simply the correlation used for the walls and floor.



\section{Heat Conduction within Solid Walls or Targets}

The heat conduction equation is solved in the direction normal to solid target or wall surfaces using non-uniformly spaced nodes and a second-order accurate central difference scheme for the spatial derivatives and a semi-implicit time marching scheme. At each time step, the internal solid temperatures are updated in time until the net convective and radiative heat flux striking the wall equals with the heat flux into the solid~\cite{Moss:1992}:
\be
   \dq'' \equiv \dqr'' + \dqc'' = -k \, \frac{dT}{dx} \Big|_{x=0} \label{eq:net_fluxes}
\ee
where $k$ is the thermal conductivity of the solid.  This solution strategy requires a differential algebraic equation (DAE) solver that can simultaneously solve both differential and algebraic equations.  With this method, only one or two extra equations are required per wall segment (two if both the interior and exterior wall segment surface temperatures are computed).  This solution strategy is more efficient than the method of lines since fewer equations need to be solved. Conduction is then coupled to the gas phase energy exchange.

A non-uniform array of internal nodes is used to capture steep gradients in temperature near the surface. Define a penetration depth of
\be
   x_p = 2 \sqrt{\alpha \, t_{\rm end}} \; \hbox{erfc}^{-1} \brackets{0.05}
\ee
where $\hbox{erfc}^{-1}$ denotes the inverse of the complementary error function. The value $x_p$ is the location in a semi-infinite wall where the temperature rise is 5~\% after $t_{\rm end}$ seconds. Eighty percent of the nodes are placed on the interior side of $x_p$ and the remaining 20~\% are placed on the exterior side.

The heat conduction equation normal to the solid surface is:
\be \frac{\partial T}{\partial t} = \frac{k}{\rho c}\frac{\partial^2 T}{\partial x^2}
\label{eq:Target_PDE} \ee
where $k$, $\rho$ and $c$ are the thermal conductivity, density and heat capacity of the target. At the surface, $x=0$, the boundary condition is:
\be
   \dq''=-k\frac{dT}{dx} \label{eq:Target_Fourier}
\ee
where $\dq''$ is the net convective and radiative heat flux.

\newcommand{\Dt}{\Delta t}
\newcommand{\Dr}{\Delta r}
\newcommand{\Tipo}{T_{i+1}^{n+1}}
\newcommand{\Ti}{T_{i}^{n+1}}
\newcommand{\Timo}{T_{i-1}^{n+1}}

The 1-D heat conduction equation can be solved in either Cartesian or cylindrical coordinates. The solution methodology shall be presented for cylindrical coordinates:
\be
  \frac{\partial T}{\partial t} = \frac{k}{\rho c} \frac{1}{r} \frac{\partial}{\partial r} \left( r \frac{\partial T}{\partial r} \right)
\ee
Dividing the cylinder into $N$ uniformly spaced concentric control volumes, this equation can be written in discretized form:
\begin{eqnarray}
\Ti-T_i^n&=& \frac{\Dt}{\Dr} \frac{k}{\rho c}
\left[
\left(\frac{\Tipo-\Ti}{\Dr}\right)
\frac{r_i}{r_{i-1/2}}-
\left(\frac{\Ti-\Timo}{\Dr}\right)
\frac{r_{i-1}}{r_{i-1/2}}
\right]
\nonumber\\[0.2in]
&=&\frac{\Dt \, \alpha}{\Dr^2}
\left[
\left(\Tipo-\Ti\right)
\left(\frac{i}{i-0.5}\right)-
\left(\Ti-\Timo\right)
\left(\frac{i-1}{i-0.5}\right)
\right]
\label{eq:cylheat6}
\end{eqnarray}
where $\alpha=k/(\rho c)$. Defining $C_i$ and $D_i$ as
\be
C_i = \frac{\alpha\Dt}{\Dr^2}\left(\frac{i-1}{i-0.5}\right) \quad ; \quad D_i = \frac{\alpha\Dt}{\Dr^2}\left(\frac{i}{i-0.5}\right)
\ee
Equation~(\ref{eq:cylheat6}) can be written:
\be
-C_i \, \Timo + \left( 1+2\frac{\alpha\Dt}{\Dr^2} \right) \, \Ti - D_i \, \Tipo = T_i^n  \quad \quad i=1...N-1
\label{eq:cylheat8}
\ee
The boundary condition is applied at control volume $N$:
\begin{eqnarray*}
T_N^{n+1}-T_N^n=\frac{\alpha\Dt}{\Dr^2}
\left[\frac{\Dr \, \dq''}{k} \frac{N}{N-0.5} -(T_N^{n+1}-T_{N-1}^{n+1}) \frac{N-1}{N-0.5} \right]
\end{eqnarray*}
or
\be
-C_N \, T_{N-1}^{n+1}+ \left( 1+C_N \right) T_N^{n+1} = T_N^n+D_N\frac{\Dr}{k} \dq''
\label{eq:cylheat10}
\ee
The internal temperature profile, $T_i$, is then obtained with a tri-diagonal linear solver.




\section{Coupling the Gas and Solid Phase Calculations}

To illustrate the method, consider a one room case with one active wall.  There are four gas phase equations (pressure, upper layer volume, upper and lower layer temperatures) and one wall temperature equation.  Implementation of the gradient matching method requires that storage be allocated for the temperature profiles at the current time step, $t$, and at the next time step, $t + \Delta t$.  Given the profile at time $t$ and values for the five unknowns at time $t + \Delta t$ (initial guess by the solver), the temperature profile is advanced from time $t$ to $t + \Delta t$.  The temperature gradient at the wall surface is computed followed by the residuals for the five equations.  The DAE solver adjusts the solution variables and the time step until the residuals for all the equations are below an error tolerance.  Once the solver has completed the step, the array storing the temperature profile for the previous time is updated, and the DAE solver is ready to take its next step.

Heat transfer between connected compartments is modeled by merging the back surfaces of the connected ceiling and floor of the compartments or the back wall surfaces of the connected horizontal compartments.  A heat conduction problem is solved for the merged walls using a temperature boundary condition for both the near and far wall.  As before, temperatures are determined by the DAE solver so that the heat flux striking the wall surface (both interior and exterior) is consistent with the temperature gradient at that surface.

For horizontal heat transfer between compartments, the connections may be between partial wall surfaces, expressed as a fraction of the wall surface. CFAST first estimates conduction fractions analogous to radiation configuration factors. For example, if only one half of the rear wall in one compartment is adjacent to the front wall in a second compartment, the conduction fraction between the two compartments is 0.5. Once these fractions are determined, an average flux, $\dq_{\rm avg}''$, is calculated using
\be
   \dq_{\rm avg}'' = \sum_{\rm walls} \, F_{i-j} \, \dq_j''
\ee
where $F_{ij}$ is the fraction of flux from wall $i$ that contributes to wall $j$, $\dq_j''$ is the flux striking wall $j$.

%
% -------------------  Fire Protection Devices ------------------------
%

\chapter{Fire Protection Devices}



\section{Sprinkler and Heat Detector Activation}

The link temperature of a sprinkler or heat detector is modeled using the differential equation~\cite{Schifiliti:2002}:
\be
   \frac{d \TL}{dt} = \frac{\sqrt{v}}{\rm RTI} \brackets{\Tg - \TL}  \label{eq:RTI}
\ee
where $\TL$ and $\Tg$ are the link and gas temperatures, $v$ is the gas speed, and RTI (Response Time Index) is a measure of the sensor's thermal inertia. The gas temperature and speed are obtained from the plume algorithm (Section~\ref{sec:Plume_Temp_Velocity}) and the ceiling jet algorithm, described below. Rooms without fires do not have ceiling jets, in which case the upper layer temperature is used, along with a fixed speed of 0.1~m/s. This value is simply an order of magnitude estimate. The link and gas temperatures and the speed are functions of time; the RTI is a constant for a given detector type. The detector equation is solved numerically using the semi-implicit updating scheme:
\be
   \frac{\TL^{n+1}-\TL^n}{\Delta t} = \frac{1}{2} \left( \frac{\sqrt{v^n}}{\rm RTI} \brackets{\Tg^n - \TL^n}  + \frac{\sqrt{v^{n+1}}}{\rm RTI} \brackets{\Tg^{n+1} - \TL^{n+1}}  \right) \label{eq:RTI_rewritten}
\ee
where the superscript $n$ denotes the value at the current time, and $\Delta t$ is the time step.

The temperature and velocity just below the ceiling is typically greater than that of the upper layer due to the presence of a ceiling jet. From the work of Alpert and Heskestad~\cite{Alpert:SFPE}, the temperature of an unconfined ceiling jet is given by:

\be
   T_{\rm cj}(r) - T_\infty = T_\infty \, \dQ^{* \, 2/3}_H \, \left\{ \begin{array}{l@{\quad}l}
   6.3                                       & ; \quad r/H\le 0.2 \\[0.1in]
   \left( 0.225 + 0.27 \, r/H \right)^{-4/3} & ; \quad 0.2 < r/H < 4.0
    \end{array} \right.
\ee
To be consistent with the calculated plume temperature, this is adjusted so that the calculated plume and ceiling jet temperatures are the same for $r/H \le 0.2$:
\be
   T_{\rm cj}(r) - T_\infty = \left\{ \begin{array}{l@{\quad}l}
   \Delta T_0(H)                                                       & ; \quad r/H\le 0.2 \\[0.1in]
   0.182 \; \Delta T_0(H) \, \left( 0.225 + 0.27 \, r/H \right)^{-4/3} & ; \quad 0.2 < r/H < 4.0
    \end{array} \right. \label{Tcj}
\ee
where $\Delta T_0(H)$ is the calculated centerline plume temperature rise at the compartment ceiling from  Eq.~(\ref{plume_temperature}) and the constant 0.182 is $\left({0.225 + 0.27 \cdot 0.2} \right)^{4/3}$.

The radial velocity is given by:
\be
   v_{\rm cj}(r) = \sqrt{g \, H} \, \dQ^{* \, 1/3}_H \left\{ \begin{array}{l@{\quad}l}
   3.61                               & ; \quad r/H \le 0.17 \\[0.1in]
   1.06 \, \left( r/H \right)^{-0.69} & ; \quad 0.17 < r/H < 4.0 \end{array} \right. \label{Ucj}
\ee
where the heat release rate of the fire is contained within the non-dimensional expression:
\be
\dQ^*_H = \frac{\dQ}{\rho_\infty \, c_p \, T_\infty \, \sqrt{g} \, H^{5/2}}  \label{QsH}
\ee
To account for the presence of an upper layer, the background temperature, $T_\infty$, in Eq.~(\ref{Tcj}) is replaced with the upper layer temperature, $\Tu$. No adjustment need be made to Eq.~(\ref{QsH}) because $\rho_\infty \, T_\infty$ is assumed constant.

An estimate of the ceiling jet thickness, $\delta$, where the excess temperature drops to 1/e of its maximum value, is given by Motevalli and Marks~\cite{Alpert:SFPE}:
\be
   \frac{\delta}{H} = 0.112 \, \left[ 1-\exp\left( -2.24 \, \frac{r}{H} \right) \right] \quad ; \quad 0.26 \le \frac{r}{H} \le 2.0
\ee
If the detector or sprinkler is below the ceiling jet layer or in a compartment without a fire, the gas temperature is taken to be upper layer temperature with a default speed of 0.1~m/s. The basis of this last value is simply an order of magnitude estimate.

If the sprinkler or detector is in a corridor of width, $W$, Delichatsios~\cite{Alpert:SFPE} suggests the following alternative to the ceiling jet correlation, Eqs.~(\ref{Tcj}) and (\ref{Ucj}). For a given distance down the corridor, $x$, from the plume centerline, the excess temperature and velocity are estimated as:
\begin{eqnarray}
   \frac{\Delta T_{\rm cj}(x)}{\Delta \Tp} &=& 0.37 \, \left( \frac{H}{W} \right)^{1/3} \, \exp \left[ -0.16 \, \left( \frac{x}{H} \right) \left( \frac{W}{H} \right)^{1/3} \right]  \\[0.1in]
   v_{\rm cj}(x) &=& 0.114 \, \sqrt{H \, \Delta T_{\rm cj}(x) } \, \left( \frac{H}{W} \right)^{1/6}
\end{eqnarray}
where $\Delta \Tp$ is the excess plume temperature at the ceiling. This correlation is applicable once the plume has reached the full width of the corridor and the ceiling jet flow is parallel to the corridor walls so that $x>W/2$. For $x<W/2$, the normal correlations apply.


\section{Visibility}
\label{Visibility}

The visibility calculation depends solely on the soot concentration. Soot production is specified by the user in terms of a yield. Soot is transported like all other gas species and its concentration is used in the optical density calculation. The optical density is given by the expression:
\be
   D = \frac{K_m \, m_{\rm s}'''}{\ln \, 10}
\ee
where $m_{\rm s}'''$ is the mass of soot per unit volume and $K_m$ is the specific extinction coefficient. The default value is 8700~m$^2$/kg based on the recommendation of Mulholland~\cite{Mulholland:SFPE}.

\section{Smoke Detection}

CFAST does not contain an algorithm that accounts for the time delay owing to smoke transport from the fire to the detector location, nor to the penetration of smoke into the detector chamber itself. Instead, CFAST treats a smoke detector as a very sensitive heat detector with an activation temperature rise of 5~$^\circ$C and RTI of 5~(m$\cdot$s)$^{1/2}$. The temperature rise estimate is based on a study performed by Bukowski and Averill~\cite{Bukowski:1998}. The RTI is not based on experiment; it simply provides a slight time delay in activation.

Users are cautioned that this model is very crude and the uncertainty in its predictions are substantial. Consult the CFAST Validation Guide for more details on its validation.


\section{Fire Suppression} \label{sec:suppression}

Fire suppression by water is predicted using a simple empirical model developed by Madrzykowski \cite{Madrzykowski:1992} and Evans~\cite{Evans:1993}. After activation of the sprinkler, $t > t_{\rm act}$, the heat release rate is assumed to decrease exponentially:
\be
   \dQ(t) = \dQ(t_{\rm act}) \; {\rm e}^{-(t-t_{\rm act}) /\tau}   \quad ; \quad \tau = 3 \, u_{\rm w}^{-1.8}
\ee
where $u_{\rm w}$ is the water spray density, expressed in units\footnote{Note the CFAST graphical interface might use other units, but the program does convert the user-specified value into mm/s.} of mm/s.  The product species mass production rates are reduced by the same amount as the heat release rate.

There are assumptions and limitations in this approach. Its main deficiency is that it assumes that sufficient water is applied to the fire to cause a decrease in the rate of heat release. This suppression model cannot handle the case when the fire overwhelms the sprinkler.  The suppression model as implemented does not include the effect of a second sprinkler. Detection of all sprinklers are noted but their activation does not make the fire go out any faster. Further, multiple fires in a room imply multiple ceiling jets. It is not clear how the two ceiling jets should interact. When there is more than one fire, the detection algorithm uses the fire that results in the highest ceiling jet temperature in order to calculate the sprinkler link temperature.

\bibliography{../Bibliography/CFAST_refs}

\appendix
\addcontentsline{toc}{chapter}{Appendices}

%
% -------------------  Nomenclature ------------------------
%

\chapter{Nomenclature}
\label{nomenclature}

Note that the units associated with a given symbol are sometimes changed upon input to and output from the program. In particular, temperatures are typically input in degrees Celsius, converted to Kelvin, and then converted back to Celsius on output. Energy units involving Joules or Watts are typically input as kJ or kW, converted to J or W, then converted back to kJ or kW.

\begin{center}
\begin{longtable}{p{1in}  p{5.5 in}}

$A$                 & area, m$^2$ \\
$A_{\rm v}$         & cross-sectional area of a vent, m$^2$ \\
$a$                 & absorption coefficient, m$^{-1}$ \\
$C$                 & vent constriction (or flow) coefficient, dimensionless \\
$C_{\rm LOL}$       & lower oxygen limit coefficient, dimensionless \\
$c_p$               & heat capacity of air at constant pressure, J/(kg$\cdot$K) or kJ/(kg$\cdot$K) \\
$c_v$               & heat capacity of air at constant volume, J/(kg$\cdot$K) or kJ/(kg$\cdot$K) \\
$c$                 & heat capacity of a solid, kJ/(kg$\cdot$K) \\
$D$                 & fire diameter, m \\
                    & optical density, m$^{-1}$ \\
$D^*$               & characteristic fire diameter, m \\
$F_{k-j}$           & configuration factor, surface $k$ intercepted by surface $j$, dimensionless \\
$f_v$               & soot volume fraction, dimensionless \\
$g$                 & gravitational constant, 9.8 m/s$^2$ \\
$h$                 & convective heat transfer coefficient, W/(m$^2\cdot$K) \\
$H$                 & height of a compartment, m \\
$k$                 & thermal conductivity of air, W/(m$\cdot$K) \\
$L$                 & length of a compartment, m \\
                    & mean flame height, m \\
                    & characteristic length for radiation calculation, m \\
$M_\alpha$          & molar mass of gas species $\alpha$, g/mol \\
$m_i$               & total mass in gas layer $i$, kg \\
$\dm_i$             & rate of mass addition, gas layer $i$, kg \\
$\dme$              & plume mass entrainment rate, kg/s \\
$\dmf$              & pyrolysis rate, kg/s \\
n$_\alpha$          & number of atoms of element $\alpha$ \\
$P$                 & pressure at floor level of a compartment, Pa \\
$\qdot_i$           & rate of addition of heat into layer $i$, kW \\
$\dQ$               & total heat release rate of the fire, kW \\
$\dQc$              & heat release rate of the fire released as convective energy, kW \\
$\dq''$             & heat flux, kW/m$^2$ \\
$R$                 & specific gas constant, J/(kg$\cdot$K) \\
RTI                 & response time index of a sprinkler or heat detector, (m$\cdot$s)$^{1/2}$ \\
$r$                 & radial distance from the fire, m \\
                    & radial coordinate of cylindrical solid, m \\
$S$                 & vent coefficient for vertical flow vents, dimensionless \\
$T_\infty$          & ambient gas temperature, K \\
$T_i$               & gas temperature of layer $i$, K \\
$\Tp$               & gas temperature in the plume, K \\
$t$                 & time, s \\
$u_{\rm w}$         & water spray density, m/s \\
$V$                 & total volume of a compartment, m$^3$ \\
$\Vl$               & total volume of lower layer in a compartment, m$^3$ \\
$\Vu$               & total volume of upper layer in a compartment, m$^3$ \\
$v$                 & gas velocity, m/s \\
$W$                 & width of a compartment, m; wall thickness, m \\
$w$                 & door or window width, m \\
$x$                 & length variable, m \\
$Y_{\rm LOL}$       & lower oxygen limit, by mass, dimensionless \\
$Y_\OTWO$           & mass fraction of oxygen in a gas layer, dimensionless \\
$y_{\CO}$           & carbon monoxide yield, kg/kg \\
$y_{\rm s}$         & soot yield, kg/kg \\
$z$                 & height variable, m \\
$\bar{z}$           & mid-range height of a vertical vent segment, m \\
$z_0$               & height of the virtual origin of fire, m \\
  \\
$\alpha$            & gas absorptance, dimensionless \\
                    & thermal diffusivity in conduction, (m$^2$/s) \\
$\gamma$            & ratio of specific heats, 1.4, dimensionless \\
$\Dh$               & heat of combustion of the fuel, kJ/kg \\
$\DhO$              & energy released per unit mass of oxygen consumed, kJ/kg \\
$\Delta T$          & temperature rise, K \\
$\epsilon$          & emissivity \\
$\nu$               & stoichiometric coefficient, dimensionless \\
                    & kinematic viscosity, m$^2$/s \\
$\rho$              & density, kg/m$^3$ \\
$\rho_\infty$       & ambient density of air, 1.2 kg/m$^3$ \\
$\sigma$            & Stefan-Boltzman constant ($5.67 \times 10^{-8}$ W/(m$^2\cdot$K$^4$) \\
$\tau$              & transmittance, dimensionless \\
$\chi_{\rm r}$      & radiative fraction, dimensionless \\
\end{longtable}

\end{center}

%
% -------------------  Equation Derivation ------------------------
%

\chapter{Modeling Equation Derivations}
\label{chap:derivation}

For convenience, Eq. \ref{eq:first_law} (conservation of energy) from Section \ref{sect:equations} used in the following derivations is re-written here:
\be
   \ddt\left(c_v m_i T_i\right)   =  \qdot_i - P \dbydt{V_i}\label{eq:afirst_law}
\ee

\section{Pressure Equation}


To derive a differential equation for compartment pressure, rewrite Eq. \ref{eq:afirst_law} for the upper and lower layer and substitute $m_i=V_i\rho_i$ to give
\begin{eqnarray}
   c_v\ddt\left( V_l\rho_l T_l\right)  &=  &\qdot_l - P \dbydt{V_l}\label{eq:lower}\\
   c_v\ddt\left( V_u\rho_u T_u\right)  &=  &\qdot_u -  P \dbydt{V_u}\label{eq:upper}
\end{eqnarray}

\noindent Summing Eqs. \ref{eq:lower} and \ref{eq:upper}, after noting that $\dbydt{V_l}=-\dbydt{V_u}$ since $\ddt(V_l+V_u)=dV/dt=0$, gives 

\begin{equation}
   c_v\ddt\left( V_l\rho_l T_l+V_u\rho_u T_u\right)  =  \qdot_l + \qdot_u
\end{equation}

\noindent which simplifies to 

\begin{eqnarray}
   \frac{c_vV}{R}\dbydt{ P}  &=  &\qdot_l + \qdot_u
\end{eqnarray}

\noindent after assuming that $\rho_l T_L=\rho_u T_U = P/R$.  
Finally $R/c_v=\gamma-1$ since $R=c_p-c_v$ and $\gamma=c_p/c_v$ giving

\begin{eqnarray}
   \dbydt{ P}  &=  &\frac{\gamma-1}{V}\left(\qdot_l + \qdot_u\right)
   \label{eq:ODE_P}
\end{eqnarray}

\noindent the pressure differential equation.

\section{Upper Layer Volume Equation}
To derive the upper layer volume differential equation, first note that
\begin{equation}
c_vm_uT_u=c_vV_u\rho_uT_u=c_vV_u\frac{P}{R}=\frac{c_v}{c_p-c_v}V_uP=\frac{1}{\gamma-1}V_uP
\label{eq:vua}
\end{equation}
\noindent Substituting Eq. \ref{eq:vua} into the upper layer form of Eq. \ref{eq:afirst_law} ($i=u$) gives
\begin{eqnarray}
\qdot_u&=&\frac{1}{\gamma-1}\ddt\left(V_uP\right) + P\dbydt{V_u}\\
&=&\frac{1}{\gamma-1}\left(P\dbydt{V_u} + V_u\dbydt{P}\right) + P\dbydt{V_u}\\
&=&\frac{\gamma}{\gamma-1}P\dbydt{V_u} + \frac{V_u}{\gamma-1}\dbydt{P}
\end{eqnarray}
Multiplying both sides by $\frac{\gamma-1}{\gamma P}$ gives
\begin{equation}
\frac{\gamma-1}{\gamma P}\qdot_u=\dbydt{V_u} + \frac{V_u}{\gamma P}\dbydt{P}\label{eq:vub}
\end{equation}

\noindent Finally, solving for $\dbydt{Vu}$ gives
\begin{equation}
\dbydt{V_u} = \frac{1}{P\gamma}\left((\gamma-1)\qdot - V_u\dbydt{P}\right)
\label{eq:ODE_VU}
\end{equation}
\noindent the upper layer volume differential equation.

\section{Temperature Equations}
To derive the upper layer temperature differential equation note that
\begin{equation}
\ddt(c_vm_uT_u)=c_v\dot m_uT_u+c_vm_u\dbydt{T_u}
\end{equation}
\noindent and from Eq. \ref{eq:ODE_VU} that
\begin{equation}
P\dbydt{Vu} = \frac{\gamma-1}{\gamma} \qdot_u - \frac{V_u}{\gamma}\dbydt{P}
\label{eq:pvu}
\end{equation}

\noindent Substituting these two expressions into the upper layer form of Eq. \ref{eq:afirst_law} (again $i=u$) gives

\begin{eqnarray}
   \ddt\left(c_v m_u T_u\right) +  P \dbydt{V_u} &=  &\qdot_u\\
c_v\dot m_uT_u+c_vm_u\dbydt{T_u}+\frac{\gamma-1}{\gamma} \qdot_u - \frac{V_u}{\gamma}\dbydt{P}&=&\qdot_u
\label{eq:tua}
\end{eqnarray}
Multiplying Eq. \ref{eq:tua} by $\gamma$ gives
\begin{equation}
c_p\dot m_uT_u+c_pm_u\dbydt{T_u} - V_u\dbydt{P}=\qdot_u
\end{equation}
Finally, solving for $\dbydt{T_u}$ gives
\begin{equation}
\dbydt{T_u}=\frac{1}{c_pm_u}\left( \qdot_u-c_p\dot m_uT_u+ V_u\dbydt{P}\right)
\label{eq:ODE_TU}
\end{equation}
\noindent the upper layer temperature differential equation.  A differential equation for lower layer temperature
\begin{equation}
\dbydt{T_l}=\frac{1}{c_pm_l}\left( \qdot_l-c_p\dot m_lT_l+ V_l\dbydt{P}\right)
\label{eq:ODE_TL}
\end{equation}
 may be derived similarly.




\label{last_page}

\end{document}
